<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>APIs, we have a Problem JSON</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Roboto+Slab:wght@800&display=swap" rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/comic-mono@0.0.1/index.css rel=stylesheet><link rel=stylesheet href=/css/style.css></head><body><header><div><a href=https://glaforge.github.io/>‚ùØ Guillaume Laforge</a><nav><ul><li><a href=/>BLOG</a></li><li><a href=/talks>TALKS</a></li><li><a href=/about>ABOUT</a></li><li><a href=/contact>CONTACT</a></li></ul></nav></div></header><main><article><h1>APIs, we have a Problem JSON</h1><time datetime=2022-11-14T13:37:09>üìÖ 2022-11-14 üïë 13:37</time><div class=author>üñã by Guillaume Laforge</div><div class=tags></div><div><p>When designing a web API, not only do you have to think about the happy path when everything is alright,
but you also have to handle all the error cases: Is the payload received correct? Is there a typo in a field?
Do you need more context about the problem that occured?</p><p>There‚Äôs only a limited set of status codes that can convey the kind of error you‚Äôre getting,
but sometimes you need to explain more clearly what the error is about.</p><p>In the past, the APIs I was designing used to follow a common JSON structure for my error messages: a simple JSON object,
usually with a <code>message</code> field, and sometimes with extra info like a custom error <code>code</code>, or a <code>details</code> field that contained a longer explanation in plain English.
However, it was my own convention, and it‚Äôs not necessarily one that is used by others, or understood by tools that interact with my API.</p><p>So that‚Äôs why today, for reporting problems with my web APIs, I tend to use <strong>Problem JSON</strong>. This is actually an RFC (<a href=https://datatracker.ietf.org/doc/html/rfc7807>RFC-7807</a>)
whose title is ‚ÄúProblem Details for HTTP APIs‚Äù. Exactly what I needed, a specification for my error messages!</p><p>First of all, it‚Äôs a JSON content-type. Your API should specify the content-type with:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span>Content-Type: application/problem+json
</span></span></span></code></pre></div><p>Content-types that end with <code>+json</code> are basically treated as application/json.</p><p>Now, an example payload from the specification looks like:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#007020;font-weight:700>HTTP</span><span style=color:#666>/</span><span style=color:#40a070>1.1</span> <span style=color:#40a070>403</span> <span style=color:#007020>Forbidden</span>
</span></span><span style=display:flex><span>Content-Type<span style=color:#666>:</span> application/problem+json
</span></span><span style=display:flex><span>Content-Language<span style=color:#666>:</span> en
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#062873;font-weight:700>&#34;type&#34;</span>: <span style=color:#4070a0>&#34;https://example.com/probs/out-of-credit&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#062873;font-weight:700>&#34;title&#34;</span>: <span style=color:#4070a0>&#34;You do not have enough credit.&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#062873;font-weight:700>&#34;detail&#34;</span>: <span style=color:#4070a0>&#34;Your current balance is 30, but that costs 50.&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#062873;font-weight:700>&#34;instance&#34;</span>: <span style=color:#4070a0>&#34;/account/12345/msgs/abc&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#062873;font-weight:700>&#34;balance&#34;</span>: <span style=color:#40a070>30</span>,
</span></span><span style=display:flex><span>   <span style=color:#062873;font-weight:700>&#34;accounts&#34;</span>: [<span style=color:#4070a0>&#34;/account/12345&#34;</span>, <span style=color:#4070a0>&#34;/account/67890&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There are some standard fields like:</p><ul><li><strong>type</strong>: a URI reference that uniquely identifies the problem type</li><li><strong>title</strong>: a short readable error statement</li><li><strong>status</strong>: the original HTTP status code from the origin server</li><li><strong>detail</strong>: a longer text explanation of the issue</li><li><strong>instance</strong>: a URI that points to the resource that has issues</li></ul><p>Then, in the example above, you also have custom fields: <code>balance</code> and <code>accounts</code>, which are specific to your application,
and not part of the specification. Which means you can expand the Problem JSON payload to include details that are specific to your application.</p><p>Note: Although I‚Äôm only covering JSON APIs, the RFC also suggests an <code>application/problem+xml</code> alternative for the XML APIs.</p><h2 id=icing-on-the-cake-built-in-support-in-micronaut>Icing on the cake: built-in support in Micronaut</h2><p>My framework of choice these days for all my apps is <a href=https://micronaut.io/>Micronaut</a>, as it‚Äôs super fast and memory efficient.
And it‚Äôs only recently that I realized there was actually a <a href=https://micronaut-projects.github.io/micronaut-problem-json/2.5.2/guide/index.html>Micronaut extension for Problem JSON</a>!
So instead of returning a custom JSON payload manually, I can use the built-in integration.</p><p>Here‚Äôs an example from the Problem JSON Micronaut extension:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#555;font-weight:700>@Controller</span><span style=color:#666>(</span><span style=color:#4070a0>&#34;/product&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>ProductController</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:#555;font-weight:700>@Get</span>
</span></span><span style=display:flex><span>  <span style=color:#555;font-weight:700>@Status</span><span style=color:#666>(</span>HttpStatus<span style=color:#666>.</span><span style=color:#4070a0>OK</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>  <span style=color:#007020;font-weight:700>public</span> <span style=color:#902000>void</span> <span style=color:#06287e>index</span><span style=color:#666>()</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>throw</span> Problem<span style=color:#666>.</span><span style=color:#4070a0>builder</span><span style=color:#666>()</span>
</span></span><span style=display:flex><span>            <span style=color:#666>.</span><span style=color:#4070a0>withType</span><span style=color:#666>(</span>URI<span style=color:#666>.</span><span style=color:#4070a0>create</span><span style=color:#666>(</span><span style=color:#4070a0>&#34;https://example.org/out-of-stock&#34;</span><span style=color:#666>))</span>
</span></span><span style=display:flex><span>            <span style=color:#666>.</span><span style=color:#4070a0>withTitle</span><span style=color:#666>(</span><span style=color:#4070a0>&#34;Out of Stock&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>            <span style=color:#666>.</span><span style=color:#4070a0>withStatus</span><span style=color:#666>(</span><span style=color:#007020;font-weight:700>new</span> HttpStatusType<span style=color:#666>(</span>HttpStatus<span style=color:#666>.</span><span style=color:#4070a0>BAD_REQUEST</span><span style=color:#666>))</span>
</span></span><span style=display:flex><span>            <span style=color:#666>.</span><span style=color:#4070a0>withDetail</span><span style=color:#666>(</span><span style=color:#4070a0>&#34;Item B00027Y5QG is no longer available&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>            <span style=color:#666>.</span><span style=color:#4070a0>with</span><span style=color:#666>(</span><span style=color:#4070a0>&#34;product&#34;</span><span style=color:#666>,</span> <span style=color:#4070a0>&#34;B00027Y5QG&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>            <span style=color:#666>.</span><span style=color:#4070a0>build</span><span style=color:#666>();</span>
</span></span><span style=display:flex><span>  <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><p>Which will return a JSON error as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#062873;font-weight:700>&#34;status&#34;</span>: <span style=color:#40a070>400</span>,
</span></span><span style=display:flex><span>    <span style=color:#062873;font-weight:700>&#34;title&#34;</span>: <span style=color:#4070a0>&#34;Out of Stock&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#062873;font-weight:700>&#34;detail&#34;</span>: <span style=color:#4070a0>&#34;Item B00027Y5QG is no longer available&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#062873;font-weight:700>&#34;type&#34;</span>: <span style=color:#4070a0>&#34;https://example.org/out-of-stock&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#062873;font-weight:700>&#34;parameters&#34;</span>: {<span style=color:#062873;font-weight:700>&#34;product&#34;</span>: <span style=color:#4070a0>&#34;B00027Y5QG&#34;</span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, I‚Äôm happy that I can use some official standard for giving more details about the errors returned by my APIs!</p></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/posts/calculating-your-potential-reach-on-mastodon-with-google-cloud-workflows-orchestrating-the-mastodon-apis/>Calculating your potential reach on Mastodon with Google Cloud Workflows orchestrating the Mastodon APIs</a></li><li><a href=/posts/turning-a-website-into-a-desktop-application/>Turning a Website Into a Desktop Application</a></li><li><a href=/posts/apis-we-have-a-problem-json/>APIs, we have a Problem JSON</a></li><li><a href=/posts/workflows-tips-and-tricks/>Workflows Tips and Tricks</a></li><li><a href=/posts/retrieve-youtube-views-count-with-youtubedl-jq-and-a-docker-container/>Retrieve YouTube views count with youtubeDL, JQ, and a Docker container</a></li></ul></div></div></aside><footer><div class=social><a href=https://uwyn.net/@glaforge><img src=/img/icons/mastodon-black.svg alt="Mastodon logo" width=42px></a>
<a href=https://twitter.com/@glaforge><img src=/img/icons/twitter-black.svg alt="Twitter logo" width=50px></a>
<a href=https://github.com/glaforge><img src=/img/icons/github-black.svg alt="Github logo" width=45px></a>
<a href=https://linkedin.com/in/glaforge><img src=/img/icons/linkedin-black.svg alt="LinkedIn logo" width=43px></a>
<a href=https://speakerdeck.com/glaforge><img src=/img/icons/speakerdeck-black.svg alt="SpeakerDeck logo" width=60px></a></div><p>&copy; 2023 <a href=/about>Guillaume Laforge</a></p></footer></body></html>