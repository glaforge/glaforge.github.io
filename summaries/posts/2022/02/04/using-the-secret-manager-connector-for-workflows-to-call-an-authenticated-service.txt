This article provides a detailed guide on securely calling APIs from Google Cloud Workflows, specifically addressing the critical issue of hardcoding API keys and demonstrating how to implement basic authentication using Google Cloud Secret Manager.

The article begins by highlighting the extensive capability of Google Cloud Workflows to interact with a wide array of APIs, including those hosted on Google Cloud and external services. It references a previous example where the SendGrid API was used to send emails from a workflow, but immediately identifies a significant security vulnerability in that demonstration: the direct hardcoding of the API key within the workflow itself. This practice is explicitly stated as "bad practice" due to the inherent security risks it poses.

To rectify this, the article introduces Google Cloud Secret Manager as the recommended secure solution for storing sensitive data such as API keys, passwords, and other credentials. A key feature emphasized is that Workflows has a dedicated connector for Secret Manager, which provides a convenient and secure method for accessing these stored secrets within a workflow.

The core objectives of the article are clearly outlined:
1.  To instruct readers on how to access secrets stored in Secret Manager using the Workflows connector.
2.  To demonstrate how to call an API that requires basic authentication.

The article then proceeds with a practical, step-by-step demonstration using YAML workflow configuration:

**1. Accessing Secrets from Secret Manager:**
The first part of the demonstration focuses on retrieving credentials from Secret Manager. The workflow uses the `googleapis.secretmanager.v1.projects.secrets.versions.accessString` method to access specific secrets.
*   It retrieves a secret identified as `basicAuthUser` and stores its value in a workflow variable named `secret_user`.
*   Similarly, it retrieves another secret identified as `basicAuthPassword` and stores its value in a variable named `secret_password`.
This ensures that the sensitive user login and password are not hardcoded but securely fetched from Secret Manager, making them available for use in subsequent workflow steps.

**2. Preparing for Basic Authentication:**
With the user login and password securely retrieved, the next step is to prepare them for basic authentication. Basic authentication typically requires the credentials to be formatted as a Base64 encoded string of `username:password`.
*   The workflow defines a new variable called `encodedUserPassword`.
*   This variable is assigned the result of concatenating `secret_user`, a colon (`:`), and `secret_password`.
*   This combined string is then encoded first into text (`text.encode`) and subsequently into Base64 format (`base64.encode`). This step generates the required `user:password` string in its Base64 encoded form, ready to be included in an HTTP Authorization header.

**3. Calling the API with Basic Authentication:**
Finally, the article demonstrates how to use the prepared `encodedUserPassword` to call an API that requires basic authentication.
*   The workflow uses the `http.get` call to make an HTTP GET request to a specified URL, which in this example is a Google Cloud Function (`https://europe-west1-workflows-days.cloudfunctions.net/basicAuthFn`).
*   Crucially, an `Authorization` header is included in the request. The value of this header is constructed by prepending the string `"Basic "` to the `encodedUserPassword` variable. This correctly formats the basic authentication header as required by the target API.
*   The response from the API call is captured in a variable named `fn_output`.
*   The workflow then returns the `body` of this `fn_output` as its final result, effectively passing through the API's response.

The article concludes by acknowledging that Workflows offers built-in support for OAuth2 and OpenID Connect (OIDC) for authenticating to Google-hosted services like Google APIs, Cloud Functions, and Cloud Run services. However, it emphasizes the significant utility of understanding how to invoke other authenticated services, particularly those requiring basic authentication or other forms of bearer tokens, as this knowledge expands the integration capabilities of Workflows for a broader range of external and legacy systems.