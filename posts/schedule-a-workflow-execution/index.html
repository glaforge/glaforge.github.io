<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Schedule a Workflow Execution</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Roboto+Slab:wght@800&display=swap" rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/comic-mono@0.0.1/index.css rel=stylesheet><link rel=stylesheet href=/css/style.css></head><body><header><div><a href=https://glaforge.github.io/>‚ùØ Guillaume Laforge</a><nav><ul><li><a href=/>BLOG</a></li><li><a href=/talks>TALKS</a></li><li><a href=/about>ABOUT</a></li><li><a href=/contact>CONTACT</a></li></ul></nav></div></header><main><article><h1>Schedule a Workflow Execution</h1><time datetime=2022-02-09T17:06:51>üìÖ 2022-02-09 üïë 17:06</time><div class=author>üñã by Guillaume Laforge</div><div class=tags><a href=/tags/google-cloud>google-cloud</a>
<a href=/tags/workflows>workflows</a>
<a href=/tags/scheduler>scheduler</a></div><div><p>There are <a href=https://cloud.google.com/workflows/docs/executing-workflow>different ways to launch the execution</a> of a workflow. In previous articles, we mentioned that you can <a href=https://cloud.google.com/workflows/docs/quickstart-gcloud>use the gcloud command-line</a> tool to create an execution, you can also use the various <a href=https://cloud.google.com/workflows/docs/quickstart-client-libraries>client libraries</a> to invoke Workflows, or use the <a href=https://cloud.google.com/workflows/docs/reference/executions/rest>REST API</a>. A workflow itself can also invoke other workflows!</p><p>But today, I&rsquo;d like to tell you how to schedule the execution of a workflow. For that purpose, we&rsquo;ll take advantage of <a href=https://cloud.google.com/scheduler>Cloud Scheduler</a>. The <a href=https://cloud.google.com/workflows/docs/schedule-workflow>documentation</a> is actually covering this topic in detail, so be sure to grab all the info there. However, I&rsquo;ll go quickly through the steps, and tell you about a nice new feature in the cloud console to ease the scheduling of workflows!</p><p>First, you need to have both Workflows and Cloud Scheduler enabled:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud services <span style=color:#007020>enable</span> cloudscheduler.googleapis.com workflows.googleapis.com
</span></span></code></pre></div><p>Cloud Scheduler will need a service account with <code>workflows.invoker</code> role, to be allowed to call Workflows:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud iam service-accounts create workflows_caller_sa
</span></span><span style=display:flex><span>gcloud projects add-iam-policy-binding MY_PROJECT_ID <span style=color:#4070a0;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#4070a0;font-weight:700></span>¬† --member serviceAccount:workflows_caller_sa@MY_PROJECT_ID.iam.gserviceaccount.com <span style=color:#4070a0;font-weight:700>\\</span>
</span></span><span style=display:flex><span>¬† --role roles/workflows.invoker
</span></span></code></pre></div><p>Now it&rsquo;s time to create the cron job:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud scheduler <span style=color:#007020>jobs</span> create http every_5_minute_schedule <span style=color:#4070a0;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#4070a0;font-weight:700></span>¬† ¬† --schedule<span style=color:#666>=</span><span style=color:#4070a0>&#34;*/5 * * * *&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#4070a0;font-weight:700></span>¬† ¬† --uri<span style=color:#666>=</span><span style=color:#4070a0>&#34;https://workflowexecutions.googleapis.com/v1/projects/MY_PROJECT_ID/locations/REGION_NAME/workflows/WORKFLOW_NAME/executions&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#4070a0;font-weight:700></span>¬† ¬† --message-body<span style=color:#666>=</span><span style=color:#4070a0>&#34;{\&#34;argument\&#34;: \&#34;DOUBLE_ESCAPED_JSON_STRING\&#34;}&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#4070a0;font-weight:700></span>¬† ¬† --time-zone<span style=color:#666>=</span><span style=color:#4070a0>&#34;America/New_York&#34;</span> <span style=color:#4070a0;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#4070a0;font-weight:700></span>¬† ¬† --oauth-service-account-email<span style=color:#666>=</span><span style=color:#4070a0>&#34;workflows_caller_sa@MY_PROJECT_ID.iam.gserviceaccount.com&#34;</span>
</span></span></code></pre></div><p>Here, you can see that Scheduler will run every 5 minutes (using the cron notation), and that it&rsquo;s going to call the Workflows REST API to create a new execution. You can also pass an argument for the workflow input.</p><p>The cool new feature I was eager to mention today was the direct integration of the scheduling as part of the Workflows creation flow, in the cloud console.</p><p>Now, when you create a new workflow, you can select a trigger:</p><p><img src=/img/schedule-workflow/scheduler-trigger-1-600.jpg alt></p><p>Click on the <code>ADD NEW TRIGGER</code> button, and select <code>Scheduler</code>. A side panel on the right will show up, and you will be able to specify the schedule to create, directly integrated, instead of having to head over to the Cloud Scheduler product section:</p><p><img src=/img/schedule-workflow/scheduler-trigger-2-600.png alt></p><p>And there, you can specify the various details of the schedule! It&rsquo;s nice to see both products nicely integrated, to ease the flow of creating a scheduled workflow.</p></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/posts/calculating-your-potential-reach-on-mastodon-with-google-cloud-workflows-orchestrating-the-mastodon-apis/>Calculating your potential reach on Mastodon with Google Cloud Workflows orchestrating the Mastodon APIs</a></li><li><a href=/posts/turning-a-website-into-a-desktop-application/>Turning a Website Into a Desktop Application</a></li><li><a href=/posts/apis-we-have-a-problem-json/>APIs, we have a Problem JSON</a></li><li><a href=/posts/workflows-tips-and-tricks/>Workflows Tips and Tricks</a></li><li><a href=/posts/retrieve-youtube-views-count-with-youtubedl-jq-and-a-docker-container/>Retrieve YouTube views count with youtubeDL, JQ, and a Docker container</a></li></ul></div></div></aside><footer><div class=social><a href=https://uwyn.net/@glaforge><img src=/img/icons/mastodon-black.svg alt="Mastodon logo" width=42px></a>
<a href=https://twitter.com/@glaforge><img src=/img/icons/twitter-black.svg alt="Twitter logo" width=50px></a>
<a href=https://github.com/glaforge><img src=/img/icons/github-black.svg alt="Github logo" width=45px></a>
<a href=https://linkedin.com/in/glaforge><img src=/img/icons/linkedin-black.svg alt="LinkedIn logo" width=43px></a>
<a href=https://speakerdeck.com/glaforge><img src=/img/icons/speakerdeck-black.svg alt="SpeakerDeck logo" width=60px></a></div><p>&copy; 2023 <a href=/about>Guillaume Laforge</a></p></footer></body></html>